{"version":3,"file":"usePDF.js","sources":["../src/usePDF.tsx"],"sourcesContent":["// @ts-ignore\nimport { PDFLinkService } from \"pdfjs-dist/es5/web/pdf_viewer\";\nimport React, {\n\tuseEffect, useState, useRef, useCallback, useMemo, Fragment\n} from \"react\";\nimport styles from \"./styles/usePDF.module.css\";\nimport parse from \"react-html-parser\";\nimport { PDFDocumentProxy, PDFPageProxy } from \"pdfjs-dist/types/display/api\";\nimport { PageViewport } from \"pdfjs-dist/types/display/display_utils\";\nimport { faSpinner } from \"@fortawesome/free-solid-svg-icons\"\n\nconst CMAP_URL = \"pdfjs-dist/cmaps/\";\n\nconst PlaceholderPage = ({ width, height, type = \"place\", loadingImage = faSpinner }: IPlaceholderPage): JSX.Element => (\n\t<div style={{ width: `${width}px`, height: `${height}px` }} data-type={type}>\n\t\t<img src={loadingImage} className={styles.spinner} alt=\"Loading...\" />\n\t</div>\n);\n\nconst PDFPage = ({\n\twidth, height, pageNum, imageSrc, children, type = \"canvas\"\n}: IPDFPage): JSX.Element => (\n\t<div data-type={type} id={`page${pageNum}`} style={{ width: `${width}px`, height: `${height}px` }}>\n\t\t<img src={imageSrc} style={{ width: \"100%\", height: \"100%\" }} alt={`Page ${pageNum}`} />\n\t\t{ children }\n\t</div>\n);\n\nconst usePDF = ({ source, loadingImage, quality = 80, enableAnnotations = true }: IUsePDF) => {\n\tconst [pdfDoc, setPdfDoc] = useState<PDFDocumentProxy>();\n\tconst [pages, setPages] = useState<JSX.Element[]>([]);\n\tconst scaleRef = useRef(1);\n\tconst viewportRef = useRef<PageViewport>();\n\tconst renderQueue = useRef<number[]>([]);\n\tconst pdfjsLib = useRef<Partial<IPDFJSLib>>({});\n\tconst pageCanvasRef = useRef(document.createElement(\"canvas\"));\n\tconst linkService = useMemo(() => new PDFLinkService(), []);\n\tconst pageRendering = useRef(false);\n\n\tconst renderPage = useCallback((num) => {\n\t\tpageRendering.current = true;\n\t\t// Using promise to fetch the page\n\t\tpdfDoc?.getPage(num).then((page: PDFPageProxy) => {\n\t\t\tconst viewport = page.getViewport({ scale: scaleRef.current });\n\t\t\tpageCanvasRef.current.height = viewport.height;\n\t\t\tpageCanvasRef.current.width = viewport.width;\n\t\t\tconst ctx = pageCanvasRef.current.getContext(\"2d\") as CanvasRenderingContext2D;\n\n\t\t\t// Render PDF page into canvas context\n\t\t\tconst renderContext = {\n\t\t\t\tcanvasContext: ctx,\n\t\t\t\tviewport,\n\t\t\t\tenableWebGL: true\n\t\t\t};\n\n\t\t\tconst loadingTask = page.render(renderContext);\n\n\t\t\tloadingTask.promise.then(() => page.getAnnotations())\n\t\t\t\t.then((annotationData) => {\n\t\t\t\t\tlet annotationDiv: HTMLDivElement;\n\t\t\t\t\tif (enableAnnotations) {\n\t\t\t\t\t\tannotationDiv = document.createElement(\"div\");\n\t\t\t\t\t\tannotationDiv.id = `annot${num}`;\n\t\t\t\t\t\tannotationDiv.className = \"annotationLayer\";\n\n\t\t\t\t\t\tpdfjsLib.current.AnnotationLayer.render({\n\t\t\t\t\t\t\tviewport: viewport.clone({ dontFlip: true }),\n\t\t\t\t\t\t\tdiv: annotationDiv,\n\t\t\t\t\t\t\tannotations: annotationData,\n\t\t\t\t\t\t\tpage,\n\t\t\t\t\t\t\tlinkService\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tsetPages((oldPages) => {\n\t\t\t\t\t\tconst newPages = [...oldPages];\n\t\t\t\t\t\tconst { width, height } = viewportRef.current ?? { width: 100, height: 100 };\n\t\t\t\t\t\tnewPages[num] = (\n\t\t\t\t\t\t\t<PDFPage\n\t\t\t\t\t\t\t\tpageNum={num}\n\t\t\t\t\t\t\t\twidth={width}\n\t\t\t\t\t\t\t\theight={height}\n\t\t\t\t\t\t\t\timageSrc={pageCanvasRef.current.toDataURL(\"image/jpeg\", quality / 100)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ enableAnnotations ? parse(annotationDiv.outerHTML) : null}\n\t\t\t\t\t\t\t</PDFPage>\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn newPages;\n\t\t\t\t\t});\n\n\t\t\t\t\tpageRendering.current = false;\n\t\t\t\t\tpage.cleanup();\n\t\t\t\t\tif (renderQueue.current.length > 0) {\n\t\t\t\t\t\t// New page rendering is pending\n\t\t\t\t\t\tconst no = renderQueue.current.shift();\n\t\t\t\t\t\tsetTimeout(() => renderPage(no), 0);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((e) => {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t});\n\t\t});\n\t}, [pdfDoc, linkService, quality, enableAnnotations]);\n\n\tconst queueRenderPage = useCallback((num: number) => {\n\t\tif (pageRendering.current) {\n\t\t\tif (!renderQueue.current.includes(num)) {\n\t\t\t\trenderQueue.current.push(num);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\trenderPage(num);\n\t\t}\n\t}, [renderPage]);\n\n\tconst changeZoom = useCallback(({ scale, viewer, scrollContainer }: IChangeZoom) => {\n\t\trenderQueue.current.length = 0;\n\t\tscaleRef.current = scale;\n\t\tconst oldHeight = viewportRef.current?.height ?? 1;\n\t\tpdfDoc?.getPage(1).then((page) => {\n\t\t\tviewportRef.current = page.getViewport({ scale });\n\t\t\tconst { width, height } = viewportRef.current;\n\t\t\tpage.cleanup();\n\t\t\tlet currPage = 1;\n\t\t\tif (viewer && scrollContainer) {\n\t\t\t\tconst { children } = viewer ?? {};\n\t\t\t\tfor (let i = 0; i < children.length; i += 1) {\n\t\t\t\t\tif (children[i].offsetTop <= scrollContainer.scrollTop + 33) {\n\t\t\t\t\t\tcurrPage = i + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tsetPages((oldPages) => {\n\t\t\t\tconst newPages = oldPages.map((pg, index) => {\n\t\t\t\t\tif (!pg) {\n\t\t\t\t\t\treturn <Fragment></Fragment>;\n\t\t\t\t\t}\n\t\t\t\t\tconst { imageSrc, children } = pg.props;\n\t\t\t\t\tif (imageSrc) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<PDFPage pageNum={index} width={width} height={height} imageSrc={imageSrc}>\n\t\t\t\t\t\t\t\t{ children }\n\t\t\t\t\t\t\t</PDFPage>\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn <PlaceholderPage width={width} height={height} loadingImage={loadingImage} />;\n\t\t\t\t});\n\t\t\t\treturn newPages;\n\t\t\t});\n\n\t\t\tqueueRenderPage(currPage);\n\t\t\tif (currPage + 1 < pdfDoc.numPages) {\n\t\t\t\tqueueRenderPage(currPage + 1);\n\t\t\t}\n\t\t\tfor (let i = 1; i <= pdfDoc.numPages; i += 1) {\n\t\t\t\tif (i !== currPage && i !== currPage + 1) {\n\t\t\t\t\tqueueRenderPage(i);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (scrollContainer) {\n\t\t\t\tconst scroller = scrollContainer;\n\t\t\t\tconst ratio = viewportRef.current.height / oldHeight;\n\t\t\t\tscroller.scrollTop *= ratio;\n\t\t\t}\n\t\t});\n\t}, [pdfDoc, queueRenderPage, loadingImage]);\n\n\tuseEffect(() => {\n\t\tif (pdfDoc) {\n\t\t\tpdfDoc.getPage(1).then((page) => {\n\t\t\t\tviewportRef.current = page.getViewport({ scale: scaleRef.current });\n\t\t\t\tpage.cleanup();\n\t\t\t\tsetPages((oldPages) => {\n\t\t\t\t\tconst { width, height } = viewportRef.current ?? { width: 100, height: 100 };\n\t\t\t\t\tconst { numPages } = pdfDoc;\n\t\t\t\t\tconst newPages = [...oldPages];\n\t\t\t\t\tfor (let i = 1; i <= numPages; i += 1) {\n\t\t\t\t\t\tnewPages[i] = <PlaceholderPage width={width} height={height} loadingImage={loadingImage} />;\n\t\t\t\t\t}\n\t\t\t\t\treturn newPages;\n\t\t\t\t});\n\n\t\t\t\tfor (let i = 1; i <= pdfDoc.numPages; i += 1) {\n\t\t\t\t\tqueueRenderPage(i);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, [pdfDoc, queueRenderPage, loadingImage]);\n\n\tuseEffect(() => {\n\t\t// @ts-ignore\n\t\timport(\"pdfjs-dist/es5/build/pdf\").then((lib) => {\n\t\t\tpdfjsLib.current = lib as IPDFJSLib;\n\t\t\t// @ts-ignore\n\t\t\timport(\"pdfjs-dist/es5/build/pdf.worker.entry\")\n\t\t\t\t.then((pdfjsWorker) => {\n\t\t\t\t\tpdfjsLib.current.GlobalWorkerOptions.workerSrc = pdfjsWorker;\n\n\t\t\t\t\tconst loadingTask = pdfjsLib.current?.getDocument({\n\t\t\t\t\t\tcMapUrl: CMAP_URL,\n\t\t\t\t\t\tcMapPacked: true,\n\t\t\t\t\t\t...source\n\t\t\t\t\t});\n\t\t\t\t\tloadingTask.promise.then((pdfDocument: PDFDocumentProxy) => {\n\t\t\t\t\t\t// Document loaded, specifying document for the viewer and\n\t\t\t\t\t\t// the (optional) linkService.\n\t\t\t\t\t\tsetPdfDoc(pdfDocument);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}, [source]);\n\n\tuseEffect(() => () => {\n\t\tpdfDoc?.cleanup();\n\t\tpdfDoc?.destroy();\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, []);\n\n\treturn {\n\t\tchangeZoom,\n\t\tpages\n\t};\n};\n\nexport { usePDF }\n"],"names":["CMAP_URL","PlaceholderPage","width","height","type","loadingImage","faSpinner","React","style","src","className","styles","spinner","alt","PDFPage","pageNum","imageSrc","children","id","usePDF","source","quality","enableAnnotations","useState","pdfDoc","setPdfDoc","pages","setPages","scaleRef","useRef","viewportRef","renderQueue","pdfjsLib","pageCanvasRef","document","createElement","linkService","useMemo","PDFLinkService","pageRendering","renderPage","useCallback","num","current","getPage","then","page","viewport","getViewport","scale","ctx","getContext","renderContext","canvasContext","enableWebGL","loadingTask","render","promise","getAnnotations","annotationData","annotationDiv","AnnotationLayer","clone","dontFlip","div","annotations","oldPages","newPages","toDataURL","parse","outerHTML","cleanup","length","no","shift","setTimeout","catch","e","console","error","queueRenderPage","includes","push","changeZoom","viewer","scrollContainer","oldHeight","currPage","i","offsetTop","scrollTop","map","pg","index","Fragment","props","numPages","scroller","ratio","useEffect","lib","pdfjsWorker","GlobalWorkerOptions","workerSrc","getDocument","cMapUrl","cMapPacked","pdfDocument","destroy"],"mappings":"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"}